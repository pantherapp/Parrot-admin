(this.webpackJsonpparrot=this.webpackJsonpparrot||[]).push([[0],{324:function(e,t,r){e.exports=r(482)},329:function(e,t,r){},482:function(e,t,r){"use strict";r.r(t);var a=r(0),n=r.n(a),c=r(15),o=r.n(c),u=(r(329),r(571)),s=r(570),i=r(17),l=r.n(i),d=r(31),f=r(20),p=r.n(f),m=(r(167),r(215),r(192)),h=r(111),b=r(103),g=r(61),v=(r(483),r(249)),w=r.n(v),x=r(68),E=function(e){return new Promise((function(t,r){var a=new FileReader;a.readAsDataURL(e.rawFile),a.onload=function(){return t(a.result)},a.onerror=r}))},O=function(e){return new Promise((function(t){var r=document.createElement("img");r.onload=function(){t({width:this.width,height:this.height})},r.src=e.src}))},k=function(){var e=Object(d.a)(l.a.mark((function e(t,r,a,n,c){var o,u,s,i,d,f,m;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r[t]){e.next=3;break}return e.abrupt("return",!1);case 3:if(o=Array.isArray(o)?o[0]:o,u=o.rawFile,s={},!(o&&u&&u.name)){e.next=32;break}return i=p.a.storage().ref().child("".concat(c,"/").concat(a,"/").concat(t)),e.next=10,i.put(u);case 10:return d=e.sent,e.next=13,d.ref.getDownloadURL();case 13:if(f=e.sent,s[t]=[{}],s[t][0].uploadedAt=new Date,s[t][0].src=f,s[t][0].type=u.type,s[t][0].name=u.name,0!==u.type.indexOf("image/")){e.next=31;break}return e.prev=20,e.next=23,O(o);case 23:m=e.sent,s[t][0].width=m.width,s[t][0].height=m.height,e.next=31;break;case 28:e.prev=28,e.t0=e.catch(20),console.error("Failed to get image dimensions");case 31:return e.abrupt("return",s);case 32:return e.abrupt("return",!1);case 33:case"end":return e.stop()}}),e,null,[[20,28]])})));return function(t,r,a,n,c){return e.apply(this,arguments)}}(),j=function(){var e=Object(d.a)(l.a.mark((function e(t,r,a,n,c,o,u,s,i){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u&&u.map((function(e){return!!e&&Object.assign(r,e)})),s&&Object.assign(r,Object(h.a)({},i.createdAt,new Date)),(r=Object.assign(a,Object(h.a)({},i.updatedAt,new Date),r)).id||(r.id=t),e.next=6,p.a.firestore().doc("".concat(c,"/").concat(r.id)).set(o(r));case 6:return e.abrupt("return",{data:r});case 7:case"end":return e.stop()}}),e)})));return function(t,r,a,n,c,o,u,s,i){return e.apply(this,arguments)}}(),y=function(){var e=Object(d.a)(l.a.mark((function e(t,r,a,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.length&&n.map((function(e){return p.a.storage().ref().child("".concat(a,"/").concat(t,"/").concat(e)).delete()})),e.next=3,p.a.firestore().doc("".concat(a,"/").concat(t)).delete();case 3:return e.abrupt("return",{data:t});case 4:case"end":return e.stop()}}),e)})));return function(t,r,a,n){return e.apply(this,arguments)}}(),S=function(){var e=Object(d.a)(l.a.mark((function e(t,r,a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.map((function(e){return p.a.firestore().doc("".concat(r,"/").concat(e)).delete()}));case 2:return e.abrupt("return",{data:t});case 3:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),A=function(){var e=Object(d.a)(l.a.mark((function e(t,r,a){var n,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.id){e.next=13;break}return e.next=3,p.a.firestore().collection(r).doc(t.id).get();case 3:if(!(n=e.sent).exists){e.next=10;break}return(c=n.data())&&null==c.id&&(c.id=n.id),e.abrupt("return",{data:c});case 10:throw new Error("Id not found");case 11:e.next=14;break;case 13:throw new Error("Id not found");case 14:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),P=function(){var e=Object(d.a)(l.a.mark((function e(t,r,a){var n,c,o,u,s,i,d,f,h,b,g,v,x,E,O;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.pagination){e.next=19;break}return n=[],e.next=4,p.a.firestore().collection(r).get();case 4:c=e.sent,o=Object(m.a)(c.docs);try{for(o.s();!(u=o.n()).done;)s=u.value,(i=s.data())&&null==i.id&&(i.id=s.id),n.push(i)}catch(a){o.e(a)}finally{o.f()}return t.filter&&(n=n.filter((function(e){for(var r=!0,a=0,n=Object.keys(t.filter);a<n.length;a++){var c=n[a];r=e[c]===t.filter[c]}return r}))),t.sort&&n.sort(w()("".concat("ASC"===t.sort.order?"":"-").concat(t.sort.field))),d=n.map((function(e){return e.id})),f=t.pagination,h=f.page,b=f.perPage,g=(h-1)*b,v=h*b,x=n?n.slice(g,v):[],E=d.slice(g,v)||[],O=n?n.length:0,e.abrupt("return",{data:x,ids:E,total:O});case 19:throw new Error("Error processing request");case 20:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),I=function(){var e=Object(d.a)(l.a.mark((function e(t,r,a){var n,c,o,u,s,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],c=Object(m.a)(t.ids),e.prev=2,c.s();case 4:if((o=c.n()).done){e.next=13;break}return u=o.value,e.next=8,A({id:u},r,a);case 8:s=e.sent,i=s.data,n.push(i);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),c.e(e.t0);case 18:return e.prev=18,c.f(),e.finish(18);case 21:return e.abrupt("return",{data:n});case 22:case"end":return e.stop()}}),e,null,[[2,15,18,21]])})));return function(t,r,a){return e.apply(this,arguments)}}(),_=function(){var e=Object(d.a)(l.a.mark((function e(t,r,a){var n,c,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.target){e.next=11;break}return t.filter||(t.filter={}),t.filter[t.target]=t.id,e.next=5,P(t,r,a);case 5:return n=e.sent,c=n.data,o=n.total,e.abrupt("return",{data:c,total:o});case 11:throw new Error("Error processing request");case 12:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),F={upload:k,save:j,del:y,delMany:S,getItemID:function(e,t,r,a,n){var c=e.data.id||e.id||e.data.key||e.key;if(c||(c=p.a.firestore().collection(a).doc().id),!c)throw new Error("ID is required");if(n&&n[c]&&t===x.a)throw new Error("ID already in use");return c},getOne:A,getList:P,getMany:I,getManyReference:_,addUploadFeature:function(e){return function(t,r,a){if("UPDATE"===t&&a.data.image&&a.data.image.length){var n=a.data.image.filter((function(e){return!(e.rawFile instanceof File)})),c=a.data.image.filter((function(e){return e.rawFile instanceof File}));return Promise.all(c.map(E)).then((function(e){return e.map((function(e){return{src:e,title:"".concat(a.data.title)}}))})).then((function(c){return e(t,r,Object(g.a)(Object(g.a)({},a),{},{data:Object(g.a)(Object(g.a)({},a.data),{},{image:[].concat(Object(b.a)(c),Object(b.a)(n))})}))}))}return e(t,r,a)}},convertFileToBase64:E},L={initialQuerytimeout:1e4,timestampFieldNames:{createdAt:"createdAt",updatedAt:"updatedAt"}},R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t=Object.assign({},L,t),a=r.timestampFieldNames,n=r.trackedResources,c={},o={},u={},s={};0===p.a.apps.length&&(p.a.initializeApp(e),p.a.auth().setPersistence(p.a.auth.Auth.Persistence.SESSION));var i=t.upload||F.upload,f=t.save||F.save,m=t.del||F.del,h=t.getItemID||F.getItemID,b=t.getOne||F.getOne,g=t.getMany||F.getMany,v=t.getManyReference||F.getManyReference,w=t.delMany||F.delMany,E=t.getList||F.getList,O=t.firebaseSaveFilter?t.firebaseSaveFilter:function(e){return e};return n.map((function(e,t){typeof e===Array&&(e={name:e.name,path:e.path||e.name,uploadFields:e.uploadFields||[]},n[t]=e);var r=e,a=r.name,c=r.path,i=r.uploadFields;if(!e.name)throw new Error("name is missing from resource ".concat(e));s[a]=i||[],u[a]=c||a,o[a]={}})),function(){var e=Object(d.a)(l.a.mark((function e(t,r,n){var d,p,k,j,y,S;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c[r];case 2:d=null,e.t0=t,e.next=e.t0===x.d?6:e.t0===x.e?10:e.t0===x.f?14:e.t0===x.g?18:e.t0===x.b?22:e.t0===x.c?27:e.t0===x.h||e.t0===x.a?31:41;break;case 6:return e.next=8,E(n,r,o[r]);case 8:return d=e.sent,e.abrupt("return",d);case 10:return e.next=12,g(n,r,o[r]);case 12:return d=e.sent,e.abrupt("return",d);case 14:return e.next=16,v(n,r,o[r]);case 16:return d=e.sent,e.abrupt("return",d);case 18:return e.next=20,b(n,r,o[r]);case 20:return d=e.sent,e.abrupt("return",d);case 22:return p=s[r]?s[r]:[],e.next=25,m(n.id,r,u[r],p);case 25:return d=e.sent,e.abrupt("return",d);case 27:return e.next=29,w(n.ids,r,o[r]);case 29:return d=e.sent,e.abrupt("return",d);case 31:return k=h(n,t,r,u[r],o[r]),j=s[r]?s[r].map((function(e){return i(e,n.data,k,r,u[r])})):[],y=o[r][k]||{},e.next=36,Promise.all(j);case 36:return S=e.sent,e.next=39,f(k,n.data,y,r,u[r],O,S,t===x.a,a);case 39:return d=e.sent,e.abrupt("return",d);case 41:return console.error("Undocumented method: ",t),e.abrupt("return",{data:[]});case 43:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}()},U=r(104),D={userProfilePath:"/users/",userAdminProp:"isAdmin",localStorageTokenName:"RAFirebaseClientToken",handleAuthStateChange:function(){var e=Object(d.a)(l.a.mark((function e(t,r){var a,n,c,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=19;break}return e.next=3,p.a.firestore().doc(r.userProfilePath+t.user.uid).get();case 3:if(a=e.sent,!(n=a.data())||!n[r.userAdminProp]){e.next=14;break}return e.next=8,t.user.getIdToken();case 8:return c=e.sent,o={auth:t,profile:n,firebaseToken:c},localStorage.setItem(r.localStorageTokenName,c),e.abrupt("return",o);case 14:throw p.a.auth().signOut(),localStorage.removeItem(r.localStorageTokenName),new Error("sign_in_error");case 17:e.next=21;break;case 19:throw localStorage.removeItem(r.localStorageTokenName),new Error("sign_in_error");case 21:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object(g.a)(Object(g.a)({},D),e);var t=function(){return new Promise((function(e){p.a.auth().onAuthStateChanged(e)}))};return function(){var r=Object(d.a)(l.a.mark((function r(a,n){var c,o,u,s,i;return l.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a!==U.e){r.next=3;break}return e.handleAuthStateChange(null,e).catch((function(){})),r.abrupt("return",p.a.auth().signOut());case 3:if(!p.a.auth().currentUser){r.next=6;break}return r.next=6,p.a.auth().currentUser.reload();case 6:if(a!==U.a){r.next=12;break}return r.next=9,t();case 9:if(p.a.auth().currentUser){r.next=11;break}throw new Error("sign_in_error");case 11:return r.abrupt("return",!0);case 12:if(a!==U.c){r.next=22;break}return console.log("AUTH_GET_PERMISSIONS"),r.next=16,t();case 16:if(p.a.auth().currentUser){r.next=18;break}throw new Error("sign_in_error");case 18:return r.next=20,p.a.auth().currentUser.getIdTokenResult();case 20:return c=r.sent,r.abrupt("return",c.claims);case 22:if(a!==U.d){r.next=30;break}if(o=n.username,u=n.password,s=n.alreadySignedIn,(i=p.a.auth().currentUser)&&s){r.next=29;break}return r.next=28,p.a.auth().signInWithEmailAndPassword(o,u);case 28:i=r.sent;case 29:return r.abrupt("return",e.handleAuthStateChange(i,e));case 30:return r.abrupt("return",!1);case 31:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}()},T=r(64),C=r(572),N=r(573),B=r(579),q=r(575),J=r(578),V=r(101),W=r(549),z=r(262),K=r(553),Q=r(556),G=r(582),H=r(554),Z=r(555),$=function(e){var t=e.record,r=Object(V.a)(),c=Object(a.useState)(),o=Object(T.a)(c,2),u=o[0],s=o[1],i=Object(a.useState)(),l=Object(T.a)(i,2),d=l[0],f=l[1],p=Object(a.useState)(!0),m=Object(T.a)(p,2),h=m[0],b=m[1],g=Object(a.useState)(),v=Object(T.a)(g,2),w=v[0],x=v[1];return Object(a.useEffect)((function(){r.getList("comments",{pagination:{page:1,perPage:1e5},sort:{},filter:{voice_doc_id:t.id}}).then((function(e){var t=e.data,r=e.total;s(r),f(t),b(!1)})).catch((function(e){x(e),b(!1)}))}),[]),h?n.a.createElement(W.a,null):w?n.a.createElement(z.a,null):u?d?n.a.createElement(K.a,null,n.a.createElement(H.a,null,n.a.createElement(Z.a,null,n.a.createElement(G.a,null,"Location"),n.a.createElement(G.a,null,"Voice"))),n.a.createElement(Q.a,null,d.map((function(e){return n.a.createElement(Z.a,{key:e.created_timestamp},n.a.createElement(G.a,null,e.address),n.a.createElement(G.a,null,n.a.createElement("audio",{controls:!0,src:e.voice_url})))})))):[]:n.a.createElement(B.a,{record:{no:"No Comment"},source:"no"})};$.defaultProps={addLabel:!0};var X=$,Y=function(e){var t=e.record,r=Object(V.a)(),c=Object(a.useState)(),o=Object(T.a)(c,2),u=o[0],s=o[1],i=Object(a.useState)(!0),l=Object(T.a)(i,2),d=l[0],f=l[1],p=Object(a.useState)(),m=Object(T.a)(p,2),h=m[0],b=m[1];Object(a.useEffect)((function(){r.getList("comments",{pagination:{page:1,perPage:1e5},sort:{},filter:{voice_doc_id:t.id}}).then((function(e){e.data;var t=e.total;s(t),f(!1)})).catch((function(e){b(e),f(!1)}))}),[]);var g={result:u+"  Comments"};return d?n.a.createElement(W.a,null):h?n.a.createElement(z.a,null):n.a.createElement(B.a,{record:g,source:"result"})},ee=r(293),te={no:"No Report",yes:"Reported by user"},re=function(e){var t=e.record;Object(ee.a)(e,["record"]);return t.report_users?n.a.createElement(B.a,{record:te,source:"yes"}):n.a.createElement(B.a,{record:te,source:"no"})};re.defaultProps={addLabel:!0};var ae=re,ne=function(e){var t=e.record;return n.a.createElement("audio",{controls:!0,src:t.voice_url})};ne.defaultProps={addLabel:!0};var ce=ne,oe=function(e){return n.a.createElement(C.a,e,n.a.createElement(N.a,{rowClick:"show"},n.a.createElement(B.a,{label:"Location",source:"address"}),n.a.createElement(Y,{label:"Comments",source:"id"}),n.a.createElement(ce,{label:"Voice",source:"voice_url"}),n.a.createElement(ae,{source:"report_users"})))},ue=function(e){return n.a.createElement(q.a,e,n.a.createElement(J.a,null,n.a.createElement(B.a,{label:"Location",source:"address"}),n.a.createElement(ce,{label:"Voice",source:"voice_url"}),n.a.createElement(X,{label:"Comments",source:"id"}),n.a.createElement(ae,{source:"report_users"})))},se={userProfilePath:"/users/",userAdminProp:"isAdmin"},ie=R({apiKey:"AIzaSyBhiU47emMZuyJ9AQbJPesDKo5l6qNL7O8",authDomain:"parrot-c87c3.firebaseapp.com",databaseURL:"https://parrot-c87c3.firebaseio.com",projectId:"parrot-c87c3",storageBucket:"parrot-c87c3.appspot.com",messagingSenderId:"470642441118",appId:"1:470642441118:web:02d787a5530ba65da6348f"},{trackedResources:[{name:"voices",path:"voices"}]}),le=function(){return n.a.createElement(u.a,{dataProvider:ie,authProvider:M(se)},n.a.createElement(s.a,{name:"voices",list:oe,show:ue}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(le,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[324,1,2]]]);
//# sourceMappingURL=main.7c451a84.chunk.js.map