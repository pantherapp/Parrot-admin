{"ast":null,"code":"import _toConsumableArray from\"/Users/yrm/Sites/parrot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/yrm/Sites/parrot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/yrm/Sites/parrot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/yrm/Sites/parrot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _asyncToGenerator from\"/Users/yrm/Sites/parrot/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";var addUploadFeature=function addUploadFeature(requestHandler){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(type,resource,params){var newParams,_i,_Object$entries,_Object$entries$_i,key,value;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(type==='UPDATE'||type==='CREATE')){_context.next=17;break;}newParams={};_i=0,_Object$entries=Object.entries(params.data);case 3:if(!(_i<_Object$entries.length)){_context.next=16;break;}_Object$entries$_i=_slicedToArray(_Object$entries[_i],2),key=_Object$entries$_i[0],value=_Object$entries$_i[1];if(!Array.isArray(value)){_context.next=9;break;}_context.next=8;return convertToArrayOfBase64Objects(value);case 8:newParams[key]=_context.sent;case 9:if(!(value&&value.rawFile instanceof File)){_context.next=13;break;}_context.next=12;return convertToBase64Object(value);case 12:newParams[key]=_context.sent;case 13:_i++;_context.next=3;break;case 16:params.data=_objectSpread(_objectSpread({},params.data),newParams);case 17:return _context.abrupt(\"return\",requestHandler(type,resource,params));case 18:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2,_x3){return _ref.apply(this,arguments);};}();};var convertFileToBase64=function convertFileToBase64(file){return new Promise(function(resolve,reject){var reader=new FileReader();reader.readAsDataURL(file.rawFile);reader.onload=function(){return resolve(reader.result);};reader.onerror=reject;});};var convertToBase64Object=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(file){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return convertFileToBase64(file);case 2:_context2.t0=_context2.sent;_context2.t1=\"\".concat(file.title);return _context2.abrupt(\"return\",{src:_context2.t0,title:_context2.t1});case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function convertToBase64Object(_x4){return _ref2.apply(this,arguments);};}();var convertToArrayOfBase64Objects=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(array){var formerFields,newFiles,transformedNewFiles;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:formerFields=array.filter(function(p){return!(p.rawFile instanceof File);});newFiles=array.filter(function(p){return p.rawFile instanceof File;});_context3.next=4;return Promise.all(newFiles.map(convertToBase64Object));case 4:transformedNewFiles=_context3.sent;return _context3.abrupt(\"return\",[].concat(_toConsumableArray(transformedNewFiles),_toConsumableArray(formerFields)));case 6:case\"end\":return _context3.stop();}}},_callee3);}));return function convertToArrayOfBase64Objects(_x5){return _ref3.apply(this,arguments);};}();export default addUploadFeature;","map":{"version":3,"sources":["/Users/yrm/Sites/parrot/src/lib/Base64Uploader.js"],"names":["addUploadFeature","requestHandler","type","resource","params","newParams","Object","entries","data","key","value","Array","isArray","convertToArrayOfBase64Objects","rawFile","File","convertToBase64Object","convertFileToBase64","file","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","title","src","array","formerFields","filter","p","newFiles","all","map","transformedNewFiles"],"mappings":"0sBAAA,GAAMA,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAAAC,cAAc,iGAAI,iBAAOC,IAAP,CAAaC,QAAb,CAAuBC,MAAvB,qLACnCF,IAAI,GAAK,QAAT,EAAqBA,IAAI,GAAK,QADK,2BAEjCG,SAFiC,CAErB,EAFqB,sBAGVC,MAAM,CAACC,OAAP,CAAeH,MAAM,CAACI,IAAtB,CAHU,0HAGzBC,GAHyB,uBAGpBC,KAHoB,2BAI/BC,KAAK,CAACC,OAAN,CAAcF,KAAd,CAJ+B,+CAKVG,CAAAA,6BAA6B,CAACH,KAAD,CALnB,QAKjCL,SAAS,CAACI,GAAD,CALwB,2BAO/BC,KAAK,EAAIA,KAAK,CAACI,OAAN,WAAyBC,CAAAA,IAPH,kDAQVC,CAAAA,qBAAqB,CAACN,KAAD,CARX,SAQjCL,SAAS,CAACI,GAAD,CARwB,0DAYrCL,MAAM,CAACI,IAAP,gCACKJ,MAAM,CAACI,IADZ,EAEKH,SAFL,EAZqC,wCAiBhCJ,cAAc,CAACC,IAAD,CAAOC,QAAP,CAAiBC,MAAjB,CAjBkB,yDAAJ,wEAAvC,CAoBE,GAAMa,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,CAAAC,IAAI,QAC9B,IAAIC,CAAAA,OAAJ,CAAY,SAACC,OAAD,CAAUC,MAAV,CAAqB,CAC/B,GAAMC,CAAAA,MAAM,CAAG,GAAIC,CAAAA,UAAJ,EAAf,CACAD,MAAM,CAACE,aAAP,CAAqBN,IAAI,CAACJ,OAA1B,EAEAQ,MAAM,CAACG,MAAP,CAAgB,iBAAML,CAAAA,OAAO,CAACE,MAAM,CAACI,MAAR,CAAb,EAAhB,CACAJ,MAAM,CAACK,OAAP,CAAiBN,MAAjB,CACD,CAND,CAD8B,EAAhC,CASA,GAAML,CAAAA,qBAAqB,2FAAG,kBAAME,IAAN,6IAEfD,CAAAA,mBAAmB,CAACC,IAAD,CAFJ,2DAGhBA,IAAI,CAACU,KAHW,oCAE1BC,GAF0B,cAG1BD,KAH0B,wEAAH,kBAArBZ,CAAAA,qBAAqB,8CAA3B,CAOA,GAAMH,CAAAA,6BAA6B,2FAAG,kBAAMiB,KAAN,oKAC9BC,YAD8B,CACfD,KAAK,CAACE,MAAN,CAAa,SAAAC,CAAC,QAAI,EAAEA,CAAC,CAACnB,OAAF,WAAqBC,CAAAA,IAAvB,CAAJ,EAAd,CADe,CAE9BmB,QAF8B,CAEnBJ,KAAK,CAACE,MAAN,CAAa,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACnB,OAAF,WAAqBC,CAAAA,IAAzB,EAAd,CAFmB,wBAGFI,CAAAA,OAAO,CAACgB,GAAR,CAAYD,QAAQ,CAACE,GAAT,CAAapB,qBAAb,CAAZ,CAHE,QAG9BqB,mBAH8B,8EAKzBA,mBALyB,qBAKDN,YALC,4DAAH,kBAA7BlB,CAAAA,6BAA6B,8CAAnC,CAQA,cAAeb,CAAAA,gBAAf","sourcesContent":["const addUploadFeature = requestHandler => async (type, resource, params) => {\n    if (type === 'UPDATE' || type === 'CREATE') {\n      let newParams = {};\n      for (const [key, value] of Object.entries(params.data)) {\n        if (Array.isArray(value)) {\n          newParams[key] = await convertToArrayOfBase64Objects(value);\n        }\n        if (value && value.rawFile instanceof File) {\n          newParams[key] = await convertToBase64Object(value);\n        }\n      }\n  \n      params.data = {\n        ...params.data,\n        ...newParams\n      };\n    }\n    return requestHandler(type, resource, params);\n  };\n  \n  const convertFileToBase64 = file =>\n    new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.readAsDataURL(file.rawFile);\n  \n      reader.onload = () => resolve(reader.result);\n      reader.onerror = reject;\n    });\n  \n  const convertToBase64Object = async file => {\n    return {\n      src: await convertFileToBase64(file),\n      title: `${file.title}`\n    };\n  };\n  \n  const convertToArrayOfBase64Objects = async array => {\n    const formerFields = array.filter(p => !(p.rawFile instanceof File));\n    const newFiles = array.filter(p => p.rawFile instanceof File);\n    const transformedNewFiles = await Promise.all(newFiles.map(convertToBase64Object));\n  \n    return [...transformedNewFiles, ...formerFields];\n  };\n  \n  export default addUploadFeature;"]},"metadata":{},"sourceType":"module"}