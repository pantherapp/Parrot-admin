{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/inheritsLoose\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport React, { Component, forwardRef } from 'react';\nimport { getPosX, throttle } from './utils';\n\nvar ProgressBar = function (_Component) {\n  _inheritsLoose(ProgressBar, _Component);\n\n  function ProgressBar() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _Component.call.apply(_Component, [this].concat(args)) || this;\n\n    _defineProperty(_assertThisInitialized(_this), \"audio\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"timeOnMouseMove\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"hasAddedAudioEventListener\", false);\n\n    _defineProperty(_assertThisInitialized(_this), \"downloadProgressAnimationTimer\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      isDraggingProgress: false,\n      currentTimePos: '0%',\n      hasDownloadProgressAnimation: false,\n      downloadProgressArr: []\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getCurrentProgress\", function (event) {\n      var _this$props = _this.props,\n          audio = _this$props.audio,\n          progressBar = _this$props.progressBar;\n\n      if (!audio.src || !isFinite(audio.currentTime) || !progressBar.current) {\n        return {\n          currentTime: 0,\n          currentTimePos: '0%'\n        };\n      }\n\n      var progressBarRect = progressBar.current.getBoundingClientRect();\n      var maxRelativePos = progressBarRect.width;\n      var relativePos = getPosX(event) - progressBarRect.left;\n\n      if (relativePos < 0) {\n        relativePos = 0;\n      } else if (relativePos > maxRelativePos) {\n        relativePos = maxRelativePos;\n      }\n\n      var currentTime = _this.props.audio.duration * relativePos / maxRelativePos;\n      return {\n        currentTime: currentTime,\n        currentTimePos: (relativePos / maxRelativePos * 100).toFixed(2) + \"%\"\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleContextMenu\", function (event) {\n      event.preventDefault();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleMouseDownOrTouchStartProgressBar\", function (event) {\n      event.stopPropagation();\n\n      var _this$getCurrentProgr = _this.getCurrentProgress(event.nativeEvent),\n          currentTime = _this$getCurrentProgr.currentTime,\n          currentTimePos = _this$getCurrentProgr.currentTimePos;\n\n      if (isFinite(currentTime)) {\n        _this.timeOnMouseMove = currentTime;\n\n        _this.setState({\n          isDraggingProgress: true,\n          currentTimePos: currentTimePos\n        });\n\n        if (event.nativeEvent instanceof MouseEvent) {\n          window.addEventListener('mousemove', _this.handleWindowMouseOrTouchMove);\n          window.addEventListener('mouseup', _this.handleWindowMouseOrTouchUp);\n        } else {\n          window.addEventListener('touchmove', _this.handleWindowMouseOrTouchMove);\n          window.addEventListener('touchend', _this.handleWindowMouseOrTouchUp);\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleWindowMouseOrTouchMove\", function (event) {\n      event.preventDefault();\n      event.stopPropagation();\n      var windowSelection = window.getSelection();\n\n      if (windowSelection && windowSelection.type === 'Range') {\n        windowSelection.empty();\n      }\n\n      var isDraggingProgress = _this.state.isDraggingProgress;\n\n      if (isDraggingProgress) {\n        var _this$getCurrentProgr2 = _this.getCurrentProgress(event),\n            currentTime = _this$getCurrentProgr2.currentTime,\n            currentTimePos = _this$getCurrentProgr2.currentTimePos;\n\n        _this.timeOnMouseMove = currentTime;\n\n        _this.setState({\n          currentTimePos: currentTimePos\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleWindowMouseOrTouchUp\", function (event) {\n      event.stopPropagation();\n\n      _this.setState(function (prevState) {\n        if (prevState.isDraggingProgress && isFinite(_this.timeOnMouseMove)) {\n          _this.props.audio.currentTime = _this.timeOnMouseMove;\n        }\n\n        return {\n          isDraggingProgress: false\n        };\n      });\n\n      if (event instanceof MouseEvent) {\n        window.removeEventListener('mousemove', _this.handleWindowMouseOrTouchMove);\n        window.removeEventListener('mouseup', _this.handleWindowMouseOrTouchUp);\n      } else {\n        window.removeEventListener('touchmove', _this.handleWindowMouseOrTouchMove);\n        window.removeEventListener('touchend', _this.handleWindowMouseOrTouchUp);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleAudioTimeUpdate\", throttle(function (e) {\n      var isDraggingProgress = _this.state.isDraggingProgress;\n      var audio = e.target;\n      if (isDraggingProgress) return;\n      var duration = audio.duration,\n          currentTime = audio.currentTime;\n\n      _this.setState({\n        currentTimePos: (currentTime / duration * 100 || 0).toFixed(2) + \"%\"\n      });\n    }, _this.props.progressUpdateInterval));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleAudioDownloadProgressUpdate\", function (e) {\n      var audio = e.target;\n      var downloadProgressArr = [];\n\n      for (var i = 0; i < audio.buffered.length; i++) {\n        var bufferedStart = audio.buffered.start(i);\n        var bufferedEnd = audio.buffered.end(i);\n        downloadProgressArr.push({\n          left: (Math.round(100 / audio.duration * bufferedStart) || 0) + \"%\",\n          width: (Math.round(100 / audio.duration * (bufferedEnd - bufferedStart)) || 0) + \"%\"\n        });\n      }\n\n      clearTimeout(_this.downloadProgressAnimationTimer);\n\n      _this.setState({\n        downloadProgressArr: downloadProgressArr,\n        hasDownloadProgressAnimation: true\n      });\n\n      _this.downloadProgressAnimationTimer = setTimeout(function () {\n        _this.setState({\n          hasDownloadProgressAnimation: false\n        });\n      }, 200);\n    });\n\n    return _this;\n  }\n\n  var _proto = ProgressBar.prototype;\n\n  _proto.componentDidUpdate = function componentDidUpdate() {\n    var audio = this.props.audio;\n\n    if (audio && !this.hasAddedAudioEventListener) {\n      this.audio = audio;\n      this.hasAddedAudioEventListener = true;\n      audio.addEventListener('timeupdate', this.handleAudioTimeUpdate);\n      audio.addEventListener('progress', this.handleAudioDownloadProgressUpdate);\n    }\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    if (this.audio && this.hasAddedAudioEventListener) {\n      this.audio.removeEventListener('timeupdate', this.handleAudioTimeUpdate);\n      this.audio.removeEventListener('progress', this.handleAudioDownloadProgressUpdate);\n    }\n\n    clearTimeout(this.downloadProgressAnimationTimer);\n  };\n\n  _proto.render = function render() {\n    var _this$props2 = this.props,\n        showDownloadProgress = _this$props2.showDownloadProgress,\n        showFilledProgress = _this$props2.showFilledProgress,\n        progressBar = _this$props2.progressBar;\n    var _this$state = this.state,\n        currentTimePos = _this$state.currentTimePos,\n        downloadProgressArr = _this$state.downloadProgressArr,\n        hasDownloadProgressAnimation = _this$state.hasDownloadProgressAnimation;\n    return React.createElement(\"div\", {\n      className: \"rhap_progress-container\",\n      ref: progressBar,\n      \"aria-label\": \"Audio Progress Control\",\n      role: \"progressbar\",\n      \"aria-valuemin\": 0,\n      \"aria-valuemax\": 100,\n      \"aria-valuenow\": Number(currentTimePos.split('%')[0]),\n      tabIndex: 0,\n      onMouseDown: this.handleMouseDownOrTouchStartProgressBar,\n      onTouchStart: this.handleMouseDownOrTouchStartProgressBar,\n      onContextMenu: this.handleContextMenu\n    }, React.createElement(\"div\", {\n      className: \"rhap_progress-bar \" + (showDownloadProgress ? 'rhap_progress-bar-show-download' : '')\n    }, React.createElement(\"div\", {\n      className: \"rhap_progress-indicator\",\n      style: {\n        left: currentTimePos\n      }\n    }), showFilledProgress && React.createElement(\"div\", {\n      className: \"rhap_progress-filled\",\n      style: {\n        width: currentTimePos\n      }\n    }), showDownloadProgress && downloadProgressArr.map(function (_ref, i) {\n      var left = _ref.left,\n          width = _ref.width;\n      return React.createElement(\"div\", {\n        key: i,\n        className: \"rhap_download-progress\",\n        style: {\n          left: left,\n          width: width,\n          transitionDuration: hasDownloadProgressAnimation ? '.2s' : '0s'\n        }\n      });\n    })));\n  };\n\n  return ProgressBar;\n}(Component);\n\nvar ProgressBarForwardRef = function ProgressBarForwardRef(props, ref) {\n  return React.createElement(ProgressBar, _extends({}, props, {\n    progressBar: ref\n  }));\n};\n\nexport default forwardRef(ProgressBarForwardRef);\nexport { ProgressBar, ProgressBarForwardRef };","map":{"version":3,"sources":["/Users/yrm/Sites/parrot/node_modules/react-h5-audio-player/es/ProgressBar.js"],"names":["_extends","_assertThisInitialized","_inheritsLoose","_defineProperty","React","Component","forwardRef","getPosX","throttle","ProgressBar","_Component","_this","_len","arguments","length","args","Array","_key","call","apply","concat","isDraggingProgress","currentTimePos","hasDownloadProgressAnimation","downloadProgressArr","event","_this$props","props","audio","progressBar","src","isFinite","currentTime","current","progressBarRect","getBoundingClientRect","maxRelativePos","width","relativePos","left","duration","toFixed","preventDefault","stopPropagation","_this$getCurrentProgr","getCurrentProgress","nativeEvent","timeOnMouseMove","setState","MouseEvent","window","addEventListener","handleWindowMouseOrTouchMove","handleWindowMouseOrTouchUp","windowSelection","getSelection","type","empty","state","_this$getCurrentProgr2","prevState","removeEventListener","e","target","progressUpdateInterval","i","buffered","bufferedStart","start","bufferedEnd","end","push","Math","round","clearTimeout","downloadProgressAnimationTimer","setTimeout","_proto","prototype","componentDidUpdate","hasAddedAudioEventListener","handleAudioTimeUpdate","handleAudioDownloadProgressUpdate","componentWillUnmount","render","_this$props2","showDownloadProgress","showFilledProgress","_this$state","createElement","className","ref","role","Number","split","tabIndex","onMouseDown","handleMouseDownOrTouchStartProgressBar","onTouchStart","onContextMenu","handleContextMenu","style","map","_ref","key","transitionDuration","ProgressBarForwardRef"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/extends\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/inheritsLoose\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport React, { Component, forwardRef } from 'react';\nimport { getPosX, throttle } from './utils';\n\nvar ProgressBar = function (_Component) {\n  _inheritsLoose(ProgressBar, _Component);\n\n  function ProgressBar() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _Component.call.apply(_Component, [this].concat(args)) || this;\n\n    _defineProperty(_assertThisInitialized(_this), \"audio\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"timeOnMouseMove\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"hasAddedAudioEventListener\", false);\n\n    _defineProperty(_assertThisInitialized(_this), \"downloadProgressAnimationTimer\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      isDraggingProgress: false,\n      currentTimePos: '0%',\n      hasDownloadProgressAnimation: false,\n      downloadProgressArr: []\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getCurrentProgress\", function (event) {\n      var _this$props = _this.props,\n          audio = _this$props.audio,\n          progressBar = _this$props.progressBar;\n\n      if (!audio.src || !isFinite(audio.currentTime) || !progressBar.current) {\n        return {\n          currentTime: 0,\n          currentTimePos: '0%'\n        };\n      }\n\n      var progressBarRect = progressBar.current.getBoundingClientRect();\n      var maxRelativePos = progressBarRect.width;\n      var relativePos = getPosX(event) - progressBarRect.left;\n\n      if (relativePos < 0) {\n        relativePos = 0;\n      } else if (relativePos > maxRelativePos) {\n        relativePos = maxRelativePos;\n      }\n\n      var currentTime = _this.props.audio.duration * relativePos / maxRelativePos;\n      return {\n        currentTime: currentTime,\n        currentTimePos: (relativePos / maxRelativePos * 100).toFixed(2) + \"%\"\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleContextMenu\", function (event) {\n      event.preventDefault();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleMouseDownOrTouchStartProgressBar\", function (event) {\n      event.stopPropagation();\n\n      var _this$getCurrentProgr = _this.getCurrentProgress(event.nativeEvent),\n          currentTime = _this$getCurrentProgr.currentTime,\n          currentTimePos = _this$getCurrentProgr.currentTimePos;\n\n      if (isFinite(currentTime)) {\n        _this.timeOnMouseMove = currentTime;\n\n        _this.setState({\n          isDraggingProgress: true,\n          currentTimePos: currentTimePos\n        });\n\n        if (event.nativeEvent instanceof MouseEvent) {\n          window.addEventListener('mousemove', _this.handleWindowMouseOrTouchMove);\n          window.addEventListener('mouseup', _this.handleWindowMouseOrTouchUp);\n        } else {\n          window.addEventListener('touchmove', _this.handleWindowMouseOrTouchMove);\n          window.addEventListener('touchend', _this.handleWindowMouseOrTouchUp);\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleWindowMouseOrTouchMove\", function (event) {\n      event.preventDefault();\n      event.stopPropagation();\n      var windowSelection = window.getSelection();\n\n      if (windowSelection && windowSelection.type === 'Range') {\n        windowSelection.empty();\n      }\n\n      var isDraggingProgress = _this.state.isDraggingProgress;\n\n      if (isDraggingProgress) {\n        var _this$getCurrentProgr2 = _this.getCurrentProgress(event),\n            currentTime = _this$getCurrentProgr2.currentTime,\n            currentTimePos = _this$getCurrentProgr2.currentTimePos;\n\n        _this.timeOnMouseMove = currentTime;\n\n        _this.setState({\n          currentTimePos: currentTimePos\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleWindowMouseOrTouchUp\", function (event) {\n      event.stopPropagation();\n\n      _this.setState(function (prevState) {\n        if (prevState.isDraggingProgress && isFinite(_this.timeOnMouseMove)) {\n          _this.props.audio.currentTime = _this.timeOnMouseMove;\n        }\n\n        return {\n          isDraggingProgress: false\n        };\n      });\n\n      if (event instanceof MouseEvent) {\n        window.removeEventListener('mousemove', _this.handleWindowMouseOrTouchMove);\n        window.removeEventListener('mouseup', _this.handleWindowMouseOrTouchUp);\n      } else {\n        window.removeEventListener('touchmove', _this.handleWindowMouseOrTouchMove);\n        window.removeEventListener('touchend', _this.handleWindowMouseOrTouchUp);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleAudioTimeUpdate\", throttle(function (e) {\n      var isDraggingProgress = _this.state.isDraggingProgress;\n      var audio = e.target;\n      if (isDraggingProgress) return;\n      var duration = audio.duration,\n          currentTime = audio.currentTime;\n\n      _this.setState({\n        currentTimePos: (currentTime / duration * 100 || 0).toFixed(2) + \"%\"\n      });\n    }, _this.props.progressUpdateInterval));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleAudioDownloadProgressUpdate\", function (e) {\n      var audio = e.target;\n      var downloadProgressArr = [];\n\n      for (var i = 0; i < audio.buffered.length; i++) {\n        var bufferedStart = audio.buffered.start(i);\n        var bufferedEnd = audio.buffered.end(i);\n        downloadProgressArr.push({\n          left: (Math.round(100 / audio.duration * bufferedStart) || 0) + \"%\",\n          width: (Math.round(100 / audio.duration * (bufferedEnd - bufferedStart)) || 0) + \"%\"\n        });\n      }\n\n      clearTimeout(_this.downloadProgressAnimationTimer);\n\n      _this.setState({\n        downloadProgressArr: downloadProgressArr,\n        hasDownloadProgressAnimation: true\n      });\n\n      _this.downloadProgressAnimationTimer = setTimeout(function () {\n        _this.setState({\n          hasDownloadProgressAnimation: false\n        });\n      }, 200);\n    });\n\n    return _this;\n  }\n\n  var _proto = ProgressBar.prototype;\n\n  _proto.componentDidUpdate = function componentDidUpdate() {\n    var audio = this.props.audio;\n\n    if (audio && !this.hasAddedAudioEventListener) {\n      this.audio = audio;\n      this.hasAddedAudioEventListener = true;\n      audio.addEventListener('timeupdate', this.handleAudioTimeUpdate);\n      audio.addEventListener('progress', this.handleAudioDownloadProgressUpdate);\n    }\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    if (this.audio && this.hasAddedAudioEventListener) {\n      this.audio.removeEventListener('timeupdate', this.handleAudioTimeUpdate);\n      this.audio.removeEventListener('progress', this.handleAudioDownloadProgressUpdate);\n    }\n\n    clearTimeout(this.downloadProgressAnimationTimer);\n  };\n\n  _proto.render = function render() {\n    var _this$props2 = this.props,\n        showDownloadProgress = _this$props2.showDownloadProgress,\n        showFilledProgress = _this$props2.showFilledProgress,\n        progressBar = _this$props2.progressBar;\n    var _this$state = this.state,\n        currentTimePos = _this$state.currentTimePos,\n        downloadProgressArr = _this$state.downloadProgressArr,\n        hasDownloadProgressAnimation = _this$state.hasDownloadProgressAnimation;\n    return React.createElement(\"div\", {\n      className: \"rhap_progress-container\",\n      ref: progressBar,\n      \"aria-label\": \"Audio Progress Control\",\n      role: \"progressbar\",\n      \"aria-valuemin\": 0,\n      \"aria-valuemax\": 100,\n      \"aria-valuenow\": Number(currentTimePos.split('%')[0]),\n      tabIndex: 0,\n      onMouseDown: this.handleMouseDownOrTouchStartProgressBar,\n      onTouchStart: this.handleMouseDownOrTouchStartProgressBar,\n      onContextMenu: this.handleContextMenu\n    }, React.createElement(\"div\", {\n      className: \"rhap_progress-bar \" + (showDownloadProgress ? 'rhap_progress-bar-show-download' : '')\n    }, React.createElement(\"div\", {\n      className: \"rhap_progress-indicator\",\n      style: {\n        left: currentTimePos\n      }\n    }), showFilledProgress && React.createElement(\"div\", {\n      className: \"rhap_progress-filled\",\n      style: {\n        width: currentTimePos\n      }\n    }), showDownloadProgress && downloadProgressArr.map(function (_ref, i) {\n      var left = _ref.left,\n          width = _ref.width;\n      return React.createElement(\"div\", {\n        key: i,\n        className: \"rhap_download-progress\",\n        style: {\n          left: left,\n          width: width,\n          transitionDuration: hasDownloadProgressAnimation ? '.2s' : '0s'\n        }\n      });\n    })));\n  };\n\n  return ProgressBar;\n}(Component);\n\nvar ProgressBarForwardRef = function ProgressBarForwardRef(props, ref) {\n  return React.createElement(ProgressBar, _extends({}, props, {\n    progressBar: ref\n  }));\n};\n\nexport default forwardRef(ProgressBarForwardRef);\nexport { ProgressBar, ProgressBarForwardRef };"]},"metadata":{},"sourceType":"module"}